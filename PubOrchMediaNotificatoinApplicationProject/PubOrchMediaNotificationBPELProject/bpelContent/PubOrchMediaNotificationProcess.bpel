<!-- PubOrchMediaNotificationProcess BPEL Process [Generated by the Eclipse 
	BPEL Designer] -->
<!-- Date: Mon Mar 05 12:13:11 IST 2012 -->
<bpel:process name="PubOrchMediaNotificationProcess"
	xmlns:ns2="http://model.skytv.co.nz/media-notification/v1"
	targetNamespace="http://process.skytv.co.nz/puborch-medianotification/v1"
	suppressJoinFailure="yes" queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath2.0"
	expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath2.0"
	xmlns:tns="http://process.skytv.co.nz/puborch-medianotification/v1"
	xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
	xmlns:ns="http://service.skytv.co.nz/skygo-medianotificationservice/v1"
	xmlns:ns0="http://service.skytv.co.nz/monitor-utility/v1" xmlns:ns1="http://service.skytv.co.nz/pig-medianotification/v1"
	xmlns:ns3="http://service.skytv.co.nz/ibms/v1" xmlns:ns4="https://service.skytv.co.nz/puborch-fileService/v1"
	xmlns:ns5="http://service.skytv.co.nz/puborch-transform/v1" xmlns:ns6="http://service.skytv.co.nz/puborch-productdef/v1"
	xmlns:ns7="http://process.skytv.co.nz/puborch-inHouseMetadata/v1">

	<!-- Import the client WSDL -->
	<bpel:import namespace="http://process.skytv.co.nz/puborch-inHouseMetadata/v1"
		location="PubOrchInHouseContentProcess.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
	<bpel:import namespace="http://service.skytv.co.nz/puborch-productdef/v1"
		location="ProductDefinitionService.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
	<bpel:import namespace="http://service.skytv.co.nz/puborch-transform/v1"
		location="MediaNotificationMpxTransformService.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
	<bpel:import namespace="https://service.skytv.co.nz/puborch-fileService/v1"
		location="GenericFileService.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
	<bpel:import namespace="http://service.skytv.co.nz/ibms/v1"
		location="PubOrchMediaNotificationIBMSService.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
	<bpel:import namespace="http://service.skytv.co.nz/pig-medianotification/v1"
		location="PIGMediaNotificationService.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
	<bpel:import namespace="http://service.skytv.co.nz/monitor-utility/v1"
		location="MonitorUtilityService.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
	<bpel:import
		namespace="http://service.skytv.co.nz/skygo-medianotificationservice/v1"
		location="SkyGoMediaNotificationService.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
	<bpel:import location="PubOrchMediaNotificationProcessArtifacts.wsdl"
		namespace="http://process.skytv.co.nz/puborch-medianotification/v1"
		importType="http://schemas.xmlsoap.org/wsdl/" />

	<!-- ================================================================= -->
	<!-- PARTNERLINKS -->
	<!-- List of services participating in this BPEL process -->
	<!-- ================================================================= -->
	<bpel:partnerLinks>
		<!-- The 'client' role represents the requester of this service. -->
		<bpel:partnerLink name="client"
			partnerLinkType="tns:PubOrchMediaNotificationProcess" myRole="PubOrchMediaNotificationProcessProvider" />
		<bpel:partnerLink name="skyGoServicePL"
			partnerLinkType="tns:skyGoServicePLType" partnerRole="skyGoServiceRole"></bpel:partnerLink>
		<bpel:partnerLink name="monitorServicePL"
			partnerLinkType="tns:monitorServicePLType" partnerRole="monitorServiceRole"></bpel:partnerLink>
		<bpel:partnerLink name="pigMediaNotificationPL"
			partnerLinkType="tns:pigMediaNotificationPLType" partnerRole="pigMediaNotificationRole"></bpel:partnerLink>
		<bpel:partnerLink name="ibmsServicePL"
			partnerLinkType="tns:ibmsServicePLType" partnerRole="ibmsServiceRole"></bpel:partnerLink>
		<bpel:partnerLink name="fileServicePL"
			partnerLinkType="tns:fileServicePLType" partnerRole="fileServiceRole"></bpel:partnerLink>
		<bpel:partnerLink name="mpxTransformServicePL"
			partnerLinkType="tns:mpxTransformServicePLType" partnerRole="mpxTransformServiceRole"></bpel:partnerLink>
		<bpel:partnerLink name="productDefinitionServicePL"
			partnerLinkType="tns:productDefinitionServicePLType" partnerRole="productDefinitionServiceRole"></bpel:partnerLink>
		<bpel:partnerLink name="InHouseContentProcessPL"
			partnerLinkType="ns7:PubOrchInHouseProcess" partnerRole="PubOrchInHouseProcessProvider"></bpel:partnerLink>
	</bpel:partnerLinks>

	<!-- ================================================================= -->
	<!-- VARIABLES -->
	<!-- List of messages and XML documents used within this BPEL process -->
	<!-- ================================================================= -->
	<bpel:variables>
		<!-- Reference to the message passed as input during initiation -->
		<bpel:variable name="input"
			messageType="tns:PubOrchMediaNotificationProcessRequestMessage" />

		<!-- Reference to the message that will be returned to the requester -->
		<bpel:variable name="output"
			messageType="tns:PubOrchMediaNotificationProcessResponseMessage" />
		<bpel:variable name="skyGoServicePLResponse"
			messageType="ns:NotifyRequestResponse"></bpel:variable>
		<bpel:variable name="skyGoServicePLRequest" messageType="ns:NotifyRequestRequest"></bpel:variable>
		<bpel:variable name="monitorServicePLRequest"
			messageType="ns0:MonitorRequest"></bpel:variable>
		<bpel:variable name="pigMediaNotificationPLResponse"
			messageType="ns1:PubOrchMediaNotificationResponseMessage"></bpel:variable>
		<bpel:variable name="pigMediaNotificationPLRequest"
			messageType="ns1:PubOrchMediaNotificationRequestMessage"></bpel:variable>
		<bpel:variable name="ibmsServicePLResponse" messageType="ns3:GetMediaProviderResponse"></bpel:variable>
		<bpel:variable name="ibmsServicePLRequest" messageType="ns3:GetMediaProviderRequest"></bpel:variable>
		<bpel:variable name="ibmsServicePLResponse1"
			messageType="ns3:GetVodMediaMetadataResponse"></bpel:variable>
		<bpel:variable name="ibmsServicePLRequest1" messageType="ns3:GetVodMediaMetadataRequest"></bpel:variable>
		<bpel:variable name="fileServicePLResponse" messageType="ns4:SendToFileServiceResponse"></bpel:variable>
		<bpel:variable name="fileServicePLRequest" messageType="ns4:SendToFileServiceRequest"></bpel:variable>
		<bpel:variable name="mpxTransformServicePLResponse"
			messageType="ns5:TransformResponse"></bpel:variable>
		<bpel:variable name="mpxTransformServicePLRequest"
			messageType="ns5:TransformRequest"></bpel:variable>
		<bpel:variable name="productDefinitionServicePLResponse"
			messageType="ns6:GetVideoTypesResponse"></bpel:variable>
		<bpel:variable name="productDefinitionServicePLRequest"
			messageType="ns6:GetVideoTypesRequest"></bpel:variable>

		<bpel:variable name="vodMediaMetadata" messageType="ns3:GetVodMediaMetadataResponse"></bpel:variable>

		<bpel:variable name="InHouseContentProcessPLResponse"
			messageType="ns7:PubOrchInHouseProcessResponseMessage"></bpel:variable>
		<bpel:variable name="InHouseContentProcessPLRequest"
			messageType="ns7:PubOrchInHouseProcessRequestMessage"></bpel:variable>
	</bpel:variables>

	<!-- ================================================================= -->
	<!-- ORCHESTRATION LOGIC -->
	<!-- Set of activities coordinating the flow of messages across the -->
	<!-- services integrated within this business process -->
	<!-- ================================================================= -->
	<bpel:sequence name="main">

		<!-- Receive input from requester. Note: This maps to operation defined 
			in PubOrchMediaNotificationProcess.wsdl -->



		<bpel:receive name="ReceiveMediaNotification"
			partnerLink="client" portType="tns:PubOrchMediaNotificationProcess"
			operation="process" variable="input" createInstance="yes" />

		<!-- Generate reply to synchronous request -->


		<bpel:if name="IfNotificationStatusComplete">
			<bpel:condition expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[$input.payload/ns2:Notification/ns2:state = 'Complete']]></bpel:condition>
			<bpel:sequence>


				<bpel:flow name="Flow">
					<bpel:sequence name="SKYGOSequence">
						<bpel:assign validate="no" name="AssignSkyGO">

							<bpel:copy>
								<bpel:from>
									<bpel:literal>
										<ns0:NotifyRequest
											xmlns:ns0="http://service.skytv.co.nz/skygo-medianotificationservice/v1"
											xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
											<ns0:mediaID>ns0:mediaID</ns0:mediaID>
										</ns0:NotifyRequest>
									</bpel:literal>
								</bpel:from>
								<bpel:to variable="skyGoServicePLRequest" part="parameters"></bpel:to>
							</bpel:copy>
							<bpel:copy>
								<bpel:from part="payload" variable="input">
									<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns2:Notification/ns2:mediaID]]></bpel:query>
								</bpel:from>
								<bpel:to part="parameters" variable="skyGoServicePLRequest">
									<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:mediaID]]></bpel:query>
								</bpel:to>
							</bpel:copy>
						</bpel:assign>

						<bpel:invoke name="InvokeSkyGOMediaNotification"
							partnerLink="skyGoServicePL" operation="NotifyRequest"
							portType="ns:SkyGoMediaNotificationServicePortType"
							inputVariable="skyGoServicePLRequest" outputVariable="skyGoServicePLResponse">


							<bpel:catchAll>

								<bpel:sequence name="Sequence">
									<bpel:assign validate="no" name="AssignErrorMonitor">
										<bpel:copy>
											<bpel:from>
												<bpel:literal>
													<ns1:Monitor
														xmlns:ns1="http://service.skytv.co.nz/monitor-utility/v1"
														xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
														<MonitorRecord>
															<serviceName>serviceName</serviceName>
															<instanceId>instanceId</instanceId>
															<status>status</status>
															<dateTime>dateTime</dateTime>
															<details>
																<ANY-ELEMENT></ANY-ELEMENT>
															</details>
														</MonitorRecord>
													</ns1:Monitor>
												</bpel:literal>
											</bpel:from>
											<bpel:to variable="monitorServicePLRequest" part="parameters"></bpel:to>
										</bpel:copy>
										<bpel:copy>
											<bpel:from expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                    <![CDATA[bpel:doXslTransform("skyGoFailedToMonitorXSLT.xslt", $skyGoServicePLResponse.parameters)]]>
											</bpel:from>
											<bpel:to part="parameters" variable="monitorServicePLRequest"></bpel:to>
										</bpel:copy>


									</bpel:assign>
									<bpel:invoke name="InvokeSkyGOFailed"
										partnerLink="monitorServicePL" operation="Monitor"
										portType="ns0:MonitorUtilityServicePortType" inputVariable="monitorServicePLRequest"></bpel:invoke>
									<bpel:exit name="Exit"></bpel:exit>
								</bpel:sequence>
							</bpel:catchAll>



						</bpel:invoke>


						<bpel:assign validate="no" name="AssignSkyGOToMonitor">
							<bpel:copy>
								<bpel:from>
									<bpel:literal>
										<ns1:Monitor xmlns:ns1="http://service.skytv.co.nz/monitor-utility/v1"
											xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
											<MonitorRecord>
												<serviceName>serviceName</serviceName>
												<instanceId>instanceId</instanceId>
												<status>status</status>
												<dateTime>dateTime</dateTime>
												<details>
													<ANY-ELEMENT></ANY-ELEMENT>
												</details>
											</MonitorRecord>
										</ns1:Monitor>
									</bpel:literal>
								</bpel:from>
								<bpel:to variable="monitorServicePLRequest" part="parameters"></bpel:to>
							</bpel:copy>
							<bpel:copy>
								<bpel:from expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                    <![CDATA[bpel:doXslTransform("skyGoSuccessToMonitorXSLT.xslt", $input.payload)]]>
								</bpel:from>
								<bpel:to part="parameters" variable="monitorServicePLRequest"></bpel:to>
							</bpel:copy>
						</bpel:assign>

						<bpel:invoke name="InvokeMonitorSuccessRun"
							partnerLink="monitorServicePL" operation="Monitor"
							portType="ns0:MonitorUtilityServicePortType" inputVariable="monitorServicePLRequest"></bpel:invoke>
					</bpel:sequence>

					<bpel:sequence name="PigSequence">
						<bpel:assign validate="no" name="AssignPig">
							<bpel:copy>
								<bpel:from expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                    <![CDATA[bpel:doXslTransform("toPigMediaNotification.xslt", $input.payload)]]>
								</bpel:from>
								<bpel:to part="payload" variable="pigMediaNotificationPLRequest"></bpel:to>
							</bpel:copy>

						</bpel:assign>
						<bpel:invoke name="InvokePigMediaNotification"
							partnerLink="pigMediaNotificationPL" operation="process"
							portType="ns1:PIGMediaNotificationServicePortType" inputVariable="pigMediaNotificationPLRequest"
							outputVariable="pigMediaNotificationPLResponse">

							<bpel:catchAll>

								<bpel:sequence name="Sequence">
									<bpel:assign validate="no" name="AssignErrorMonitor">
										<bpel:copy>
											<bpel:from>
												<bpel:literal>
													<ns1:Monitor
														xmlns:ns1="http://service.skytv.co.nz/monitor-utility/v1"
														xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
														<MonitorRecord>
															<serviceName>serviceName</serviceName>
															<instanceId>instanceId</instanceId>
															<status>status</status>
															<dateTime>dateTime</dateTime>
															<details>
																<ANY-ELEMENT></ANY-ELEMENT>
															</details>
														</MonitorRecord>
													</ns1:Monitor>
												</bpel:literal>
											</bpel:from>
											<bpel:to variable="monitorServicePLRequest" part="parameters"></bpel:to>
										</bpel:copy>
										<bpel:copy>
											<bpel:from expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                    <![CDATA[bpel:doXslTransform("pigFailedToMonitorXSLT.xslt", $pigMediaNotificationPLResponse.payload)]]>
											</bpel:from>
											<bpel:to part="parameters" variable="monitorServicePLRequest"></bpel:to>
										</bpel:copy>


									</bpel:assign>
									<bpel:invoke name="InvokePigMediaNotificationFailed" partnerLink="monitorServicePL"
										operation="Monitor" portType="ns0:MonitorUtilityServicePortType"
										inputVariable="monitorServicePLRequest"></bpel:invoke>
									<bpel:exit name="Exit"></bpel:exit>
								</bpel:sequence>
							</bpel:catchAll>


						</bpel:invoke>
						<bpel:assign validate="no" name="AssignPigToMonitor">
							<bpel:copy>
								<bpel:from>
									<bpel:literal>
										<ns1:Monitor xmlns:ns1="http://service.skytv.co.nz/monitor-utility/v1"
											xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
											<MonitorRecord>
												<serviceName>serviceName</serviceName>
												<instanceId>instanceId</instanceId>
												<status>status</status>
												<dateTime>dateTime</dateTime>
												<details>
													<ANY-ELEMENT></ANY-ELEMENT>
												</details>
											</MonitorRecord>
										</ns1:Monitor>
									</bpel:literal>
								</bpel:from>
								<bpel:to variable="monitorServicePLRequest" part="parameters"></bpel:to>
							</bpel:copy>
							<bpel:copy>
								<bpel:from expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                    <![CDATA[bpel:doXslTransform("pigSuccessToMonitorXSLT.xslt", $input.payload)]]>
								</bpel:from>
								<bpel:to part="parameters" variable="monitorServicePLRequest"></bpel:to>
							</bpel:copy>
						</bpel:assign>
						<bpel:invoke name="InvokeMonitorSuccessRun"
							partnerLink="monitorServicePL" operation="Monitor"
							portType="ns0:MonitorUtilityServicePortType" inputVariable="monitorServicePLRequest"></bpel:invoke>
					</bpel:sequence>

					<bpel:sequence name="NormalSequence">

						<bpel:assign validate="no" name="AssignGetMediaProvider">
							<bpel:copy>
								<bpel:from>
									<bpel:literal>
										<ns0:GetMediaProvider xmlns:ns0="http://service.skytv.co.nz/ibms/v1"
											xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
											<ns0:mediaID>ns0:mediaID</ns0:mediaID>
										</ns0:GetMediaProvider>
									</bpel:literal>
								</bpel:from>
								<bpel:to variable="ibmsServicePLRequest" part="parameters"></bpel:to>
							</bpel:copy>
							<bpel:copy>
								<bpel:from part="payload" variable="input">
									<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns2:Notification/ns2:mediaID]]></bpel:query>
								</bpel:from>
								<bpel:to part="parameters" variable="ibmsServicePLRequest">
									<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns3:mediaID]]></bpel:query>
								</bpel:to>
							</bpel:copy>
						</bpel:assign>

						<bpel:invoke name="InvokeIbmsGetMediaProvider"
							partnerLink="ibmsServicePL" operation="GetMediaProvider"
							portType="ns3:PubOrchMediaNotificationIBMSServicePortType"
							inputVariable="ibmsServicePLRequest" outputVariable="ibmsServicePLResponse">
							<bpel:catchAll>

								<bpel:sequence name="Sequence">
									<bpel:assign validate="no" name="AssignErrorMonitor">
										<bpel:copy>
											<bpel:from>
												<bpel:literal>
													<ns1:Monitor
														xmlns:ns1="http://service.skytv.co.nz/monitor-utility/v1"
														xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
														<MonitorRecord>
															<serviceName>serviceName</serviceName>
															<instanceId>instanceId</instanceId>
															<status>status</status>
															<dateTime>dateTime</dateTime>
															<details>
																<ANY-ELEMENT></ANY-ELEMENT>
															</details>
														</MonitorRecord>
													</ns1:Monitor>
												</bpel:literal>
											</bpel:from>
											<bpel:to variable="monitorServicePLRequest" part="parameters"></bpel:to>
										</bpel:copy>
										<bpel:copy>
											<bpel:from expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                    <![CDATA[bpel:doXslTransform("normalFailedToMonitorXSLT.xslt", $ibmsServicePLResponse.parameters)]]>
											</bpel:from>
											<bpel:to part="parameters" variable="monitorServicePLRequest"></bpel:to>
										</bpel:copy>


									</bpel:assign>
									<bpel:invoke name="InvokeIbmsGetMediaProviderFailed"
										partnerLink="monitorServicePL" operation="Monitor"
										portType="ns0:MonitorUtilityServicePortType" inputVariable="monitorServicePLRequest"></bpel:invoke>
									<bpel:exit name="Exit"></bpel:exit>
								</bpel:sequence>
							</bpel:catchAll>



						</bpel:invoke>
						<bpel:if name="IfMediaProviderSky">
							<bpel:condition expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[$ibmsServicePLResponse.parameters/ns3:mediaProvider = '4788' or $ibmsServicePLResponse.parameters/ns3:mediaProvider = '55']]></bpel:condition>
							<bpel:sequence>
								<bpel:assign validate="no" name="AssignInHouseMediaID">
									<bpel:copy>
										<bpel:from>
											<bpel:literal>
												<tns:PubOrchInHouseProcessRequest
													xmlns:tns="http://process.skytv.co.nz/puborch-inHouseMetadata/v1"
													xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
													<tns:mediaId>tns:mediaId</tns:mediaId>
												</tns:PubOrchInHouseProcessRequest>
											</bpel:literal>
										</bpel:from>
										<bpel:to variable="InHouseContentProcessPLRequest"
											part="payload"></bpel:to>
									</bpel:copy>
									<bpel:copy>
										<bpel:from part="payload" variable="input">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns2:Notification/ns2:mediaID]]></bpel:query>
										</bpel:from>
										<bpel:to part="payload" variable="InHouseContentProcessPLRequest">
											<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns7:mediaId]]></bpel:query>
										</bpel:to>
									</bpel:copy>
								</bpel:assign>
								<bpel:invoke name="InvokeInHouseMediaProcess"
									partnerLink="InHouseContentProcessPL" operation="process"
									portType="ns7:PubOrchInHouseProcess" inputVariable="InHouseContentProcessPLRequest"
									outputVariable="InHouseContentProcessPLResponse"></bpel:invoke>

							</bpel:sequence>
							<bpel:else>
								<bpel:sequence name="Sequence">
									<bpel:assign validate="no" name="AssignGetMediaMetadata">
										<bpel:copy>
											<bpel:from>
												<bpel:literal>
													<ns0:GetVodMediaMetadata
														xmlns:ns0="http://service.skytv.co.nz/ibms/v1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
														<ns0:mediaID>ns0:mediaID</ns0:mediaID>
													</ns0:GetVodMediaMetadata>
												</bpel:literal>
											</bpel:from>
											<bpel:to variable="ibmsServicePLRequest1" part="parameters"></bpel:to>
										</bpel:copy>
										<bpel:copy>
											<bpel:from>
												<bpel:literal>
													<ns0:GetMediaProvider xmlns:ns0="http://service.skytv.co.nz/ibms/v1"
														xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
														<ns0:mediaID>ns0:mediaID</ns0:mediaID>
													</ns0:GetMediaProvider>
												</bpel:literal>
											</bpel:from>
											<bpel:to variable="ibmsServicePLRequest" part="parameters"></bpel:to>
										</bpel:copy>
										<bpel:copy>
											<bpel:from part="payload" variable="input">
												<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns2:Notification/ns2:mediaID]]></bpel:query>
											</bpel:from>
											<bpel:to part="parameters" variable="ibmsServicePLRequest1">
												<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                                    <![CDATA[ns3:mediaID]]>
												</bpel:query>
											</bpel:to>
										</bpel:copy>
									</bpel:assign>

									<bpel:invoke name="InvokeIbmsGetMediaMetadata"
										partnerLink="ibmsServicePL" operation="GetVodMediaMetadata"
										portType="ns3:PubOrchMediaNotificationIBMSServicePortType"
										inputVariable="ibmsServicePLRequest1" outputVariable="ibmsServicePLResponse1">

										<bpel:catchAll>

											<bpel:sequence name="Sequence">
												<bpel:assign validate="no" name="AssignErrorMonitor">
													<bpel:copy>
														<bpel:from>
															<bpel:literal>
																<ns1:Monitor
																	xmlns:ns1="http://service.skytv.co.nz/monitor-utility/v1"
																	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
																	<MonitorRecord>
																		<serviceName>serviceName</serviceName>
																		<instanceId>instanceId</instanceId>
																		<status>status</status>
																		<dateTime>dateTime</dateTime>
																		<details>
																			<ANY-ELEMENT></ANY-ELEMENT>
																		</details>
																	</MonitorRecord>
																</ns1:Monitor>
															</bpel:literal>
														</bpel:from>
														<bpel:to variable="monitorServicePLRequest" part="parameters"></bpel:to>
													</bpel:copy>
													<bpel:copy>
														<bpel:from
															expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                    <![CDATA[bpel:doXslTransform("normalFailedToMonitorXSLT.xslt", $ibmsServicePLResponse1.parameters)]]>
														</bpel:from>
														<bpel:to part="parameters" variable="monitorServicePLRequest"></bpel:to>
													</bpel:copy>


												</bpel:assign>
												<bpel:invoke name="InvokeIbmsGetMediadataFailed"
													partnerLink="monitorServicePL" operation="Monitor"
													portType="ns0:MonitorUtilityServicePortType" inputVariable="monitorServicePLRequest"></bpel:invoke>
												<bpel:exit name="Exit"></bpel:exit>
											</bpel:sequence>
										</bpel:catchAll>


									</bpel:invoke>
									<bpel:assign validate="no" name="AssignProductDefinition">
										<bpel:copy>
											<bpel:from>
												<bpel:literal>
													<ns0:GetVodMediaMetadataResponse
														xmlns:ns0="http://service.skytv.co.nz/ibms/v1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
														<Media>
															<titleId>titleId</titleId>
															<titleName>titleName</titleName>
															<certification>certification</certification>
															<duration>duration</duration>
															<audioType>audioType</audioType>
															<aspectRatio>aspectRatio</aspectRatio>
															<screenFormat>screenFormat</screenFormat>
															<mediaID>mediaID</mediaID>
														</Media>
													</ns0:GetVodMediaMetadataResponse>
												</bpel:literal>
											</bpel:from>
											<bpel:to variable="vodMediaMetadata" part="parameters"></bpel:to>
										</bpel:copy>
										<bpel:copy>
											<bpel:from expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                                <![CDATA[bpel:doXslTransform("assignToVod.xsl", $ibmsServicePLResponse1.parameters)]]>
											</bpel:from>
											<bpel:to part="parameters" variable="vodMediaMetadata"></bpel:to>
										</bpel:copy>
										<bpel:copy>
											<bpel:from expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                                <![CDATA['init']]>
											</bpel:from>
											<bpel:to part="parameters" variable="productDefinitionServicePLRequest"></bpel:to>
										</bpel:copy>
									</bpel:assign>
									<bpel:invoke name="InvokeProductDefinitionServiceGetVideoTypes"
										partnerLink="productDefinitionServicePL" operation="GetVideoTypes"
										portType="ns6:ProductDefinitionServicePortType" inputVariable="productDefinitionServicePLRequest"
										outputVariable="productDefinitionServicePLResponse">


										<bpel:catchAll>

											<bpel:sequence name="Sequence">
												<bpel:assign validate="no" name="AssignErrorMonitor">
													<bpel:copy>
														<bpel:from>
															<bpel:literal>
																<ns1:Monitor
																	xmlns:ns1="http://service.skytv.co.nz/monitor-utility/v1"
																	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
																	<MonitorRecord>
																		<serviceName>serviceName</serviceName>
																		<instanceId>instanceId</instanceId>
																		<status>status</status>
																		<dateTime>dateTime</dateTime>
																		<details>
																			<ANY-ELEMENT></ANY-ELEMENT>
																		</details>
																	</MonitorRecord>
																</ns1:Monitor>
															</bpel:literal>
														</bpel:from>
														<bpel:to variable="monitorServicePLRequest" part="parameters"></bpel:to>
													</bpel:copy>
													<bpel:copy>
														<bpel:from
															expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                    <![CDATA[bpel:doXslTransform("normalFailedToMonitorXSLT.xslt", $productDefinitionServicePLResponse.parameters)]]>
														</bpel:from>
														<bpel:to part="parameters" variable="monitorServicePLRequest"></bpel:to>
													</bpel:copy>


												</bpel:assign>
												<bpel:invoke name="InvokeProductDefinitionFailed"
													partnerLink="monitorServicePL" operation="Monitor"
													portType="ns0:MonitorUtilityServicePortType" inputVariable="monitorServicePLRequest"></bpel:invoke>
												<bpel:exit name="Exit"></bpel:exit>
											</bpel:sequence>
										</bpel:catchAll>

									</bpel:invoke>
									<bpel:assign validate="no" name="AssignTransform">

										<bpel:copy>
											<bpel:from expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                                <![CDATA[bpel:doXslTransform("toMpxTransform.xsl", $productDefinitionServicePLResponse.parameters,'vodMediaMetadata', $vodMediaMetadata.parameters)]]>
											</bpel:from>
											<bpel:to part="parameters" variable="mpxTransformServicePLRequest"></bpel:to>
										</bpel:copy>
									</bpel:assign>
									<bpel:invoke name="InvokeTransformToMpxMediaManifest"
										partnerLink="mpxTransformServicePL" operation="Transform"
										portType="ns5:MediaNotificationMpxTransformServicePortType"
										inputVariable="mpxTransformServicePLRequest" outputVariable="mpxTransformServicePLResponse">

										<bpel:catchAll>

											<bpel:sequence name="Sequence">
												<bpel:assign validate="no" name="AssignErrorMonitor">
													<bpel:copy>
														<bpel:from>
															<bpel:literal>
																<ns1:Monitor
																	xmlns:ns1="http://service.skytv.co.nz/monitor-utility/v1"
																	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
																	<MonitorRecord>
																		<serviceName>serviceName</serviceName>
																		<instanceId>instanceId</instanceId>
																		<status>status</status>
																		<dateTime>dateTime</dateTime>
																		<details>
																			<ANY-ELEMENT></ANY-ELEMENT>
																		</details>
																	</MonitorRecord>
																</ns1:Monitor>
															</bpel:literal>
														</bpel:from>
														<bpel:to variable="monitorServicePLRequest" part="parameters"></bpel:to>
													</bpel:copy>
													<bpel:copy>
														<bpel:from
															expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                    <![CDATA[bpel:doXslTransform("normalFailedToMonitorXSLT.xslt", $mpxTransformServicePLResponse.parameters)]]>
														</bpel:from>
														<bpel:to part="parameters" variable="monitorServicePLRequest"></bpel:to>
													</bpel:copy>


												</bpel:assign>
												<bpel:invoke name="InvokeMpxTransformFailed"
													partnerLink="monitorServicePL" operation="Monitor"
													portType="ns0:MonitorUtilityServicePortType" inputVariable="monitorServicePLRequest"></bpel:invoke>
												<bpel:exit name="Exit"></bpel:exit>
											</bpel:sequence>
										</bpel:catchAll>

									</bpel:invoke>
									<bpel:assign validate="no" name="AssignFileService">
										<bpel:copy>
											<bpel:from>
												<bpel:literal>
													<ns1:SendToFileServiceRequest
														xmlns:ns1="https://service.skytv.co.nz/puborch-fileService/v1"
														xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
														<fileName>fileName</fileName>
														<destination>destination</destination>
														<contents>contents</contents>
													</ns1:SendToFileServiceRequest>
												</bpel:literal>
											</bpel:from>
											<bpel:to variable="fileServicePLRequest" part="parameters"></bpel:to>
										</bpel:copy>
										<bpel:copy>
											<bpel:from expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                                <![CDATA[bpel:doXslTransform("toFileServiceXSLT.xslt", $mpxTransformServicePLResponse.parameters)]]>
											</bpel:from>
											<bpel:to part="parameters" variable="fileServicePLRequest"></bpel:to>
										</bpel:copy>
									</bpel:assign>
									<bpel:invoke name="InvokeFileService" partnerLink="fileServicePL"
										operation="SendFile" portType="ns4:GenericFileServicePortType"
										inputVariable="fileServicePLRequest" outputVariable="fileServicePLResponse">
										<bpel:catchAll>

											<bpel:sequence name="Sequence">
												<bpel:assign validate="no" name="AssignErrorMonitor">
													<bpel:copy>
														<bpel:from>
															<bpel:literal>
																<ns1:Monitor
																	xmlns:ns1="http://service.skytv.co.nz/monitor-utility/v1"
																	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
																	<MonitorRecord>
																		<serviceName>serviceName</serviceName>
																		<instanceId>instanceId</instanceId>
																		<status>status</status>
																		<dateTime>dateTime</dateTime>
																		<details>
																			<ANY-ELEMENT></ANY-ELEMENT>
																		</details>
																	</MonitorRecord>
																</ns1:Monitor>
															</bpel:literal>
														</bpel:from>
														<bpel:to variable="monitorServicePLRequest" part="parameters"></bpel:to>
													</bpel:copy>
													<bpel:copy>
														<bpel:from
															expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                    <![CDATA[bpel:doXslTransform("normalFailedToMonitorXSLT.xslt", $fileServicePLResponse.parameters)]]>
														</bpel:from>
														<bpel:to part="parameters" variable="monitorServicePLRequest"></bpel:to>
													</bpel:copy>


												</bpel:assign>
												<bpel:invoke name="InvokeFileServiceFailed"
													partnerLink="monitorServicePL" operation="Monitor"
													portType="ns0:MonitorUtilityServicePortType" inputVariable="monitorServicePLRequest"></bpel:invoke>
												<bpel:exit name="Exit"></bpel:exit>
											</bpel:sequence>
										</bpel:catchAll>


									</bpel:invoke>
									<bpel:assign validate="no" name="AssignNormalToMonitor">
										<bpel:copy>
											<bpel:from>
												<bpel:literal>
													<ns1:Monitor
														xmlns:ns1="http://service.skytv.co.nz/monitor-utility/v1"
														xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
														<MonitorRecord>
															<serviceName>serviceName</serviceName>
															<instanceId>instanceId</instanceId>
															<status>status</status>
															<dateTime>dateTime</dateTime>
															<details>
																<ANY-ELEMENT></ANY-ELEMENT>
															</details>
														</MonitorRecord>
													</ns1:Monitor>
												</bpel:literal>
											</bpel:from>
											<bpel:to variable="monitorServicePLRequest" part="parameters"></bpel:to>
										</bpel:copy>
										<bpel:copy>
											<bpel:from expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                                <![CDATA[bpel:doXslTransform("normalSuccessToMonitorXSLT.xslt", $fileServicePLResponse.parameters)]]>
											</bpel:from>
											<bpel:to part="parameters" variable="monitorServicePLRequest"></bpel:to>
										</bpel:copy>
									</bpel:assign>
									<bpel:invoke name="InvokeMonitorSuccessRun"
										partnerLink="monitorServicePL" operation="Monitor"
										portType="ns0:MonitorUtilityServicePortType" inputVariable="monitorServicePLRequest"></bpel:invoke>
								</bpel:sequence>
							</bpel:else>

						</bpel:if>


					</bpel:sequence>


				</bpel:flow>
			</bpel:sequence>
		</bpel:if>
		<bpel:assign validate="no" name="AssignOutput">
			<bpel:copy>
				<bpel:from>
					<bpel:literal>
						<tns:HandleNotificationResponse
							xmlns:tns="http://process.skytv.co.nz/puborch-medianotification/v1"
							xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">tns:HandleNotificationResponse
						</tns:HandleNotificationResponse>
					</bpel:literal>
				</bpel:from>
				<bpel:to variable="output" part="payload"></bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                    <![CDATA['Complete']]>
				</bpel:from>
				<bpel:to part="payload" variable="output"></bpel:to>
			</bpel:copy>
		</bpel:assign>
		<bpel:reply name="replyOutput" partnerLink="client"
			portType="tns:PubOrchMediaNotificationProcess" operation="process"
			variable="output" />

	</bpel:sequence>
</bpel:process>

